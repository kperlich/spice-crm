/* * *******************************************************************************
* This file is part of KReporter. KReporter is an enhancement developed
* by aac services k.s.. All rights are (c) 2016 by aac services k.s.
*
* This Version of the KReporter is licensed software and may only be used in
* alignment with the License Agreement received with this Software.
* This Software is copyrighted and may not be further distributed without
* witten consent of aac services k.s.
*
* You can contact us at info@kreporter.org
******************************************************************************* */
Ext.define("SpiceCRM.KReporter.Bucketmanager.model.enumfields",{extend:"Ext.data.Model",alias:["widget.enumfieldsModel"],fields:["options","text"]}),Ext.define("SpiceCRM.KReporter.Bucketmanager.model.language",{extend:"Ext.data.Model",alias:["widget.languageModel"],fields:["lblid","value"]}),Ext.define("SpiceCRM.KReporter.Bucketmanager.model.listEnumValues",{extend:"Ext.data.Model",alias:["widget.KReportBucketmanagerListEnumValues"],fields:[{name:"mappingvalue",mapping:"enumvalue"},{name:"label",mapping:"label"}]}),Ext.define("SpiceCRM.KReporter.Bucketmanager.model.listGroupings",{extend:"Ext.data.Model",alias:["widget.KReportBucketmanagerListGroupingsModel"],fields:[{name:"id",mapping:"id"},{name:"name",mapping:"name"},{name:"modulename",mapping:"modulename"},{name:"fieldname",mapping:"fieldname"},{name:"fieldtype",mapping:"fieldtype"},{name:"mapping",mapping:"mapping"}]}),Ext.define("SpiceCRM.KReporter.Bucketmanager.model.listMappings",{extend:"Ext.data.TreeModel",alias:["widget.KReportBucketmanagerListMappingsModel"],fields:[{name:"mappingvalue",mapping:"mappingvalue"},{name:"label",mapping:"label"}]}),Ext.define("SpiceCRM.KReporter.Bucketmanager.view.main.MainModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.main",data:{name:"KReportBucketmanager"}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.model.modules",{extend:"Ext.data.Model",alias:["widget.modulesModel"],fields:["module","name"]}),Ext.define("SpiceCRM.KReporter.Bucketmanager.store.enumfields",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Bucketmanager.model.enumfields"],model:"SpiceCRM.KReporter.Bucketmanager.model.enumfields",proxy:{type:"ajax",url:"KREST/KReporter/bucketmanager/enumfields",extraParams:{modulename:""},reader:{type:"json"}},autoLoad:!1,listeners:{load:function(a,b,c,d){a.getCount()>0}}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.reader.languageReader",{extend:"Ext.data.reader.Json",alias:"reader.languageReader",getResponseData:function(a){var b=[];return Ext.Object.each(this.callParent([a]),function(a,c){b.push({lblid:a,value:c})}),b}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.store.language",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Bucketmanager.model.language","SpiceCRM.KReporter.Bucketmanager.reader.languageReader"],model:"SpiceCRM.KReporter.Bucketmanager.model.language",isloaded:!1,proxy:{type:"ajax",url:"KREST/metadata/KReports/language",reader:{type:"languageReader"}},listeners:{load:function(){this.isloaded=!0,Ext.globalEvents.fireEvent("languageloaded")}}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.store.listEnumValues",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Bucketmanager.model.listEnumValues"],model:"SpiceCRM.KReporter.Bucketmanager.model.listEnumValues",proxy:{type:"ajax",url:"KREST/KReporter/bucketmanager/enumfieldvalues",async:!1,extraParams:{modulename:"",fieldname:"",fieldvalue:""},reader:{type:"json",rootProperty:"items",totalProperty:"total"}},autoLoad:!1,autoSync:!1,listeners:{load:function(a,b,c,d){if(Ext.data.StoreManager.lookup("KReportBucketmanagerListEnumValuesOriginalStore").loadData(b),Ext.ComponentQuery.query("#KReportBucketmanagerListGroupingsGrid")[0].view.grid.fireEvent("loadMappings",{}),SpiceCRM.KReporter.Bucketmanager.Application._enumValuesToHide.length>0){var e=[];Ext.each(SpiceCRM.KReporter.Bucketmanager.Application._enumValuesToHide,function(b){a.findExact("mappingvalue",b)>-1&&a.removeAt(a.findExact("mappingvalue",b))}),a.remove(e)}return c}}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.store.listGroupings",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Bucketmanager.model.listGroupings"],model:"SpiceCRM.KReporter.Bucketmanager.model.listGroupings",autoLoad:!0,autoSync:!1,proxy:{type:"ajax",url:"KREST/KReporter/bucketmanager/groupings",extraParams:{},reader:{type:"json"},writer:{type:"json"}}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.store.listMappings",{extend:"Ext.data.TreeStore",requires:["SpiceCRM.KReporter.Bucketmanager.model.listMappings"],model:"SpiceCRM.KReporter.Bucketmanager.model.listMappings",autoLoad:!1,autoSync:!1,root:!0,proxy:{type:"memory",extraParams:{groupingid:""},reader:{type:"json"}},listeners:{beforeload:function(a,b,c){}}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.store.modules",{extend:"Ext.data.Store",requires:["SpiceCRM.KReporter.Bucketmanager.model.modules"],model:"SpiceCRM.KReporter.Bucketmanager.model.modules",proxy:{type:"ajax",url:"KREST/metadata/modules",extraParams:{session_id:window.sessionStorage.spiceUISession},reader:{type:"json"}}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.controller.Application",{extend:"Ext.app.Controller",doInit:function(){},finishInit:function(){},onLaunch:function(){},createGuId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.controller.DDlistEnumValuesController",{extend:"Ext.app.ViewController",requires:[],alias:"controller.KReportBucketmanagerDDListEnumValuesController",config:{listen:{global:{}},control:{"#fieldFilterValues":{change:function(a,b){_grouping=Ext.ComponentQuery.query("#KReportBucketmanagerListGroupingsGrid")[0].view.getSelection(),this.view.store.clearFilter(),"enum"==_grouping[0].data.fieldtype?(this.view.store.clearFilter(),""!==b&&this.view.store.filter("label",new RegExp(b,"i"))):(this.view.store.removeAll(),this.queryValues(b))}}}},onBeforeDrop:function(a,b,c,d,e){if("root"===b.records[0].data.parentId)return!1},onDrop:function(a,b,c,d,e){Ext.globalEvents.fireEvent("saveFullRecord",{})},queryValues:function(a){this.view.store.getProxy().extraParams.fieldvalue=a,_grpRow=Ext.ComponentQuery.query("#KReportBucketmanagerListGroupingsGrid")[0].view.getSelection(),this.view.store.getProxy().extraParams.fieldname=_grpRow[0].data.fieldname,this.view.store.getProxy().extraParams.modulename=_grpRow[0].data.modulename,this.view.store.load()}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.controller.listGroupingsController",{extend:"Ext.app.ViewController",requires:[],alias:"controller.KReportBucketmanagerListGroupingsController",config:{listen:{global:{saveFullRecord:"updateGrouping",deleteFullRecord:"deleteGrouping"}},control:{"#fieldFilter":{change:function(a,b){this.view.store.clearFilter(),""!==b&&this.view.store.filter("name",new RegExp(b,"i"))}},"#KReportBucketmanagerListGroupingsGrid":{select:function(a,b){this.loadEnumValues(b)},loadMappings:function(a){var b=Ext.data.StoreManager.lookup("KReportBucketmanagerListMappingsStore"),c=Ext.data.StoreManager.lookup("KReportBucketmanagerListEnumValuesOriginalStore"),d=Ext.ComponentQuery.query("#KReportBucketmanagerListGroupingsGrid")[0].view.getSelection(),e=[],f=[];SpiceCRM.KReporter.Bucketmanager.Application._enumValuesToHide=[];var g={},h=Ext.util.Format.htmlDecode(d[0].data.mapping);if(h&&""!==h){g=Ext.decode(h),Ext.each(g.mappings,function(a){var b=[];Ext.each(a.children,function(a){var e=c.findExact("mappingvalue",a.valueOf());_label="","text"==d[0].data.fieldtype?_label=a.valueOf():null!==c.getAt(e)&&(_label=c.getAt(e).data.label);var f={mappingvalue:a.valueOf(),label:_label,leaf:!0};b.push(f),SpiceCRM.KReporter.Bucketmanager.Application._enumValuesToHide.push(a.valueOf())});var g={mappingvalue:a.mappingvalue,children:b,leaf:!1,expanded:!0,parentId:"root"};f.push(g),e.push(g)}),b.loadData(e);var i=b.getRootNode();Ext.each(f,function(a){i.appendChild(a)}),Ext.ComponentQuery.query("#kreportsbucketmanagerlistenumbalueshandler")[0].setValue(g.others)}else b.load();b.getCount()<=0?Ext.ComponentQuery.query("#KReportBucketmanagerListEnumValuesGrid")[0].view.grid.disable():Ext.ComponentQuery.query("#KReportBucketmanagerListEnumValuesGrid")[0].view.grid.enable()}},"#kreportsbucketmanagerlistgroupingsgriddeletebutton":{click:function(){var a=this.view.getSelection(),b=[];Ext.each(a,function(a){b.push(a.get("id"))}),this.view.store.remove(a),Ext.globalEvents.fireEvent("deleteFullRecord",b)}},"#kreportsbucketmanagerlistgroupingsgridaddbutton":{click:function(){var a=Ext.create("SpiceCRM.KReporter.Bucketmanager.view.KReportBucketmanager.newGroupingWindow",{});a.show()}}}},updateGrouping:function(){var a=Ext.ComponentQuery.query("#KReportBucketmanagerListGroupingsGrid")[0].view.getSelection();if(a.length<=0)return!1;var b=Ext.data.StoreManager.lookup("KReportBucketmanagerListMappingsStore").getData(),c={mappings:[],others:!1},d=-1;Ext.each(b.items,function(a){null===a.data.parentId||"root"===a.data.parentId?(c.mappings.push({mappingvalue:a.data.mappingvalue,children:[]}),d++):void 0!==c.mappings[d]&&c.mappings[d].children.push(a.data.mappingvalue)}),c.others=Ext.ComponentQuery.query("#kreportsbucketmanagerlistenumbalueshandler")[0].getValue();var e={id:a[0].data.id,name:a[0].data.name,modulename:a[0].data.modulename,fieldname:a[0].data.fieldname,mapping:Ext.util.Format.htmlEncode(Ext.encode(c))},f=Ext.data.StoreManager.lookup("KReportBucketmanagerListGroupingsStore").findRecord("id",e.id);f.data.mapping=e.mapping,Ext.Ajax.request({url:"KREST/KReporter/bucketmanager/updateGrouping",jsonData:e,method:"POST",success:function(a,b){var c=Ext.decode(a.responseText);c.success<=0&&Ext.Msg.alert(languageGetText("LBL_ERROR","LBL_ERROR_UPDATEGROUPING"))},scope:this})},deleteGrouping:function(a){var b={id:a[0]};Ext.Ajax.request({url:"KREST/KReporter/bucketmanager/deleteGrouping",jsonData:b,method:"POST",success:function(a,b){var c=Ext.decode(a.responseText);c.success>0?(Ext.data.StoreManager.lookup("KReportBucketmanagerListMappingsStore").load(),Ext.data.StoreManager.lookup("KReportBucketmanagerListEnumValuesStore").removeAll()):Ext.Msg.alert(languageGetText("LBL_ERROR","LBL_ERROR_DELETEGROUPING"))},scope:this})},loadEnumValues:function(a){var b=Ext.data.StoreManager.lookup("KReportBucketmanagerListEnumValuesStore");b.getProxy().extraParams.modulename=a.data.modulename,b.getProxy().extraParams.fieldname=a.data.fieldname,b.setPageSize(SpiceCRM.KReporter.Bucketmanager.Application._enumValuesPageSize),b.loadPage(1),b.load({params:{start:0,limit:SpiceCRM.KReporter.Bucketmanager.Application._enumValuesPageSize}})}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.controller.listMappingsController",{extend:"Ext.app.ViewController",requires:[],alias:"controller.KReportBucketmanagerListMappingsController",config:{listen:{global:{addMapping:"addMappingValue",deleteMapping:"deleteMappingValue"}},control:{"#KReportBucketmanagerListMappingsGrid":{select:function(a,b){}},"#kreportsbucketmanagerlistgriddeletemappingbutton":{click:function(){var a=this.view.getSelection();a.length>0&&Ext.globalEvents.fireEvent("deleteMapping",a)}},"#kreportsbucketmanagerlistmappingsgridaddbutton":{click:function(){Ext.globalEvents.fireEvent("addMapping",{})}}}},addMappingValue:function(){return _selectedGrouping=Ext.ComponentQuery.query("#KReportBucketmanagerListGroupingsGrid")[0].view.getSelection(),_selectedGrouping.length<=0?(Ext.Msg.alert(languageGetText("LBL_ERROR"),languageGetText("LBL_ERROR_NOGROUPINGSELECTED")),!1):void Ext.Msg.prompt(languageGetText("LBL_MAPPING_NEWVALUE"),languageGetText("LBL_MAPPING_PROMPT_NAME"),function(a,b){if("ok"==a){var c={mappingvalue:b,children:[],leaf:!1,expandable:!0,expanded:!0,parentId:"root"},d=Ext.data.StoreManager.lookup("KReportBucketmanagerListMappingsStore").getRootNode();d.appendChild(c),Ext.globalEvents.fireEvent("saveFullRecord",{}),Ext.ComponentQuery.query("#KReportBucketmanagerListEnumValuesGrid")[0].view.grid.enable()}})},deleteMappingValue:function(a){if(a.length<=0)return!1;var b=[];Ext.each(a,function(a){b.push(a),Ext.each(a.childNodes,function(a){b.push(a),Ext.data.StoreManager.lookup("KReportBucketmanagerListEnumValuesStore").add(a)}),a.data.leaf===!0&&Ext.data.StoreManager.lookup("KReportBucketmanagerListEnumValuesStore").add(a)}),this.view.store.remove(b),Ext.globalEvents.fireEvent("saveFullRecord",{}),this.view.store.getCount()<=0&&Ext.ComponentQuery.query("#KReportBucketmanagerListEnumValuesGrid")[0].view.grid.disable()},onBeforeDrop:function(a,b,c,d,e,f){return"root"!==b.records[0].data.parentId&&void Ext.each(b.records,function(a){a.set("leaf",!0),a.set("draggable",!0)})},onDrop:function(a,b,c,d,e,f){var g=Ext.data.StoreManager.lookup("KReportBucketmanagerListEnumValuesStore");Ext.each(b.records,function(a){g.remove(a)}),Ext.globalEvents.fireEvent("saveFullRecord",{})}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.controller.MainController",{extend:"Ext.app.ViewController",requires:[],saving:!1,alias:"controller.KReportBucketmanagerMain",loadMask:void 0,config:{listen:{}},atoc:function(a){return a.replace(/[a-zA-Z]/g,function(a){return String.fromCharCode((a<="Z"?90:122)>=(a=a.charCodeAt(0)+13)?a:a-26)})}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.view.KReportBucketmanager.newGroupingWindow",{extend:"Ext.window.Window",modal:!0,height:220,width:400,layout:{type:"fit"},record:null,editedField:null,editedFieldText:null,title:languageGetText("LBL_GROUPING_CREATE"),closeAction:"hide",items:[{xtype:"newGrouping"}],buttons:[{text:languageGetText("LBL_SAVE_BUTTON_LABEL"),itemId:"kreportsbucketmanagernewgroupingwindowsavebutton",handler:function(){var a=this.up("window");if(""===a.down("textfield[itemId=name]").getValue()||null===a.down("combo[itemId=mainModuleSelector]").getValue()||null===a.down("combo[itemId=mainFieldSelector]").getValue())return Ext.Msg.alert(languageGetText("LBL_ERROR"),languageGetText("LBL_ERROR_REQUIREDALL")),!1;var b={id:SpiceCRM.KReporter.Bucketmanager.Application.kGuid(),name:a.down("textfield[itemId=name]").getValue(),modulename:a.down("combo[itemId=mainModuleSelector]").getValue(),fieldname:a.down("combo[itemId=mainFieldSelector]").getValue(),fieldtype:""};Ext.Ajax.request({url:"KREST/KReporter/bucketmanager/savenewgrouping",jsonData:b,method:"POST",success:function(c,d){var e=Ext.data.StoreManager.lookup("KReportBucketmanagerListGroupingsStore");e.add(b);var f=Ext.data.StoreManager.lookup("KReportBucketmanagerListMappingsStore");f.removeAll(),f.load();var g=Ext.data.StoreManager.lookup("KReportBucketmanagerFormFieldEnumStore");g.removeAll(),Ext.ComponentQuery.query("#KReportBucketmanagerListGroupingsGrid")[0].view.grid.getSelectionModel().selectRange(e.getCount()-1,e.getCount()-1),a.close(),Ext.globalEvents.fireEvent("saveFullRecord",{})},scope:this})}},{text:languageGetText("LBL_CANCEL_BUTTON_LABEL"),handler:function(){this.up("window").close()}}],listeners:{show:function(){Ext.data.StoreManager.lookup("KReportBucketmanagerModuleStore").load()}}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.view.listEnumValuesGrid",{extend:"Ext.grid.Panel",alias:["widget.KReportBucketmanagerlistEnumValuesGrid"],requires:["SpiceCRM.KReporter.Bucketmanager.controller.DDlistEnumValuesController"],controller:"KReportBucketmanagerDDListEnumValuesController",itemId:"KReportBucketmanagerListEnumValuesGrid",store:Ext.create("SpiceCRM.KReporter.Bucketmanager.store.listEnumValues",{storeId:"KReportBucketmanagerListEnumValuesStore"}),selModel:{selType:"rowmodel",mode:"MULTI"},title:languageGetText("LBL_GRID_ENUMVALUES"),height:"100%",border:!0,columns:[{text:languageGetText("LBL_ENUMVALUE_VALUE"),dataIndex:"mappingvalue",flex:1,hidden:!0,sortable:!1},{text:languageGetText("LBL_ENUMVALUE_LABEL"),dataIndex:"label",flex:1,sortable:!1}],viewConfig:{markDirty:!1,copy:!0,plugins:{ptype:"gridviewdragdrop",ddGroup:"mappingvalues",enableDrop:!0,enableDrag:!0},listeners:{beforedrop:"onBeforeDrop",drop:"onDrop",scope:"controller"}},dockedItems:[{xtype:"toolbar",dock:"top",defaults:{padding:"5px 2px"},items:[{xtype:"checkboxfield",itemId:"kreportsbucketmanagerlistenumbalueshandler",hideLabel:!0,boxLabel:languageGetText("LBL_ENUMVALUE_HANDLER"),margin:"-2px 0px",listeners:{change:function(a,b,c,d){Ext.globalEvents.fireEvent("saveFullRecord",{})}}},"->",{xtype:"textfield",itemId:"fieldFilterValues"}]},{xtype:"pagingtoolbar",store:Ext.data.StoreManager.lookup("KReportBucketmanagerListEnumValuesStore"),dock:"bottom",displayInfo:!0}]}),Ext.define("SpiceCRM.KReporter.Bucketmanager.view.KReportBucketmanager.listGroupingsGrid",{extend:"Ext.grid.Panel",require:["SpiceCRM.KReporter.Bucketmanager.controller.listGroupingsController"],itemId:"KReportBucketmanagerListGroupingsGrid",controller:"KReportBucketmanagerListGroupingsController",alias:["widget.KReportBucketmanagerlistGroupingsGrid"],store:Ext.create("SpiceCRM.KReporter.Bucketmanager.store.listGroupings",{storeId:"KReportBucketmanagerListGroupingsStore"}),title:languageGetText("LBL_GRID_GROUPINGS"),height:"100%",border:!0,columns:[{text:languageGetText("LBL_GROUPING_ID"),dataIndex:"id",itemId:"groupingid",sortable:!1,width:150,hidden:!0},{text:languageGetText("LBL_GROUPING_NAME"),dataIndex:"name",itemId:"groupingname",sortable:!1,width:150,editor:{xtype:"textfield"}},{text:languageGetText("LBL_GROUPING_MODULENAME"),dataIndex:"modulename",sortable:!1,width:100,hidden:!1},{text:languageGetText("LBL_GROUPING_FIELDNAME"),dataIndex:"fieldname",sortable:!1,flex:1,hidden:!1},{text:languageGetText("LBL_GROUPING_FIELDTYPE"),dataIndex:"fieldtype",sortable:!1,width:30,hidden:!0},{text:languageGetText("LBL_GROUPING_MAPPING"),dataIndex:"mapping",sortable:!1,width:150,hidden:!0}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2,listeners:{edit:function(a,b){b.record.commit(),Ext.globalEvents.fireEvent("saveFullRecord",{})}}})],dockedItems:[{xtype:"toolbar",dock:"top",defaults:{padding:"5px 2px"},items:[{text:languageGetText("LBL_ADD_BUTTON_LABEL"),icon:"modules/KReports/images/add.png",itemId:"kreportsbucketmanagerlistgroupingsgridaddbutton"},{text:languageGetText("LBL_DELETE_BUTTON_LABEL"),icon:"modules/KReports/images/delete.png",itemId:"kreportsbucketmanagerlistgroupingsgriddeletebutton"},"->",{xtype:"textfield",itemId:"fieldFilter",width:"50%"}]}]}),Ext.define("SpiceCRM.KReporter.Bucketmanager.view.KReportBucketmanager.listMappingsGrid",{extend:"Ext.tree.Panel",require:["SpiceCRM.KReporter.Bucketmanager.controller.listMappingsController"],itemId:"KReportBucketmanagerListMappingsGrid",controller:"KReportBucketmanagerListMappingsController",alias:["widget.KReportBucketmanagerlistMappingsGrid"],store:Ext.create("SpiceCRM.KReporter.Bucketmanager.store.listMappings",{storeId:"KReportBucketmanagerListMappingsStore"}),rootVisible:!1,root:{text:"root",expandable:!0,expanded:!0,leaf:!1,children:[]},useArrows:!0,multiSelect:!1,title:languageGetText("LBL_GRID_MAPPINGS"),height:"100%",border:!0,columns:[{xtype:"treecolumn",text:languageGetText("LBL_MAPPING_VALUE"),dataIndex:"mappingvalue",itemId:"mappingvalue",sortable:!1,flex:1,editor:{xtype:"textfield",selectOnFocus:!0}},{text:languageGetText("LBL_ENUMVALUE_LABEL"),dataIndex:"label",itemId:"label",sortable:!1,width:150}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2,listeners:{beforeedit:function(a,b){if(b.record.data.leaf===!0)return!1},edit:function(a,b){b.record.commit(),Ext.globalEvents.fireEvent("saveFullRecord",{})}}})],listeners:{},dockedItems:[{xtype:"toolbar",dock:"top",defaults:{padding:"5px 2px"},items:[{text:languageGetText("LBL_ADD_BUTTON_LABEL"),icon:"modules/KReports/images/add.png",itemId:"kreportsbucketmanagerlistmappingsgridaddbutton"},{text:languageGetText("LBL_DELETE_BUTTON_LABEL"),icon:"modules/KReports/images/delete.png",itemId:"kreportsbucketmanagerlistgriddeletemappingbutton"}]}],viewConfig:{markDirty:!1,copy:!1,plugins:{ptype:"treeviewdragdrop",ddGroup:"mappingvalues",appendOnly:!0,sortOnDrop:!1},listeners:{beforedrop:"onBeforeDrop",drop:"onDrop",scope:"controller"}}}),Ext.define("SpiceCRM.KReporter.Bucketmanager.view.main.Main",{extend:"Ext.container.Container",requires:["SpiceCRM.KReporter.Bucketmanager.controller.MainController"],xtype:"app-main",height:Ext.getBody().getViewSize().height-150,width:"100%",renderTo:"kreportbucketmanager",border:!1,controller:"KReportBucketmanagerMain",layout:{type:"hbox"},title:"KReporter Bucket Manager",style:{"background-color":"transparent"},items:[{xtype:"KReportBucketmanagerlistGroupingsGrid",width:"30%"},{xtype:"KReportBucketmanagerlistMappingsGrid",width:"35%"},{xtype:"KReportBucketmanagerlistEnumValuesGrid",width:"35%"}]}),Ext.define("SpiceCRM.KReporter.Bucketmanager.view.newGrouping",{extend:"Ext.form.Panel",alias:"widget.newGrouping",itemId:"KReporterBucketmanagerViewNewGrouping",items:[{xtype:"textfield",name:"name",itemId:"name",fieldLabel:languageGetText("LBL_GROUPING_NAME"),allowBlank:!1,width:"80%",margin:5},{xtype:"combo",name:"modulename",itemId:"mainModuleSelector",fieldLabel:languageGetText("LBL_GROUPING_MODULENAME"),queryMode:"local",typeAhead:!0,minChars:2,store:Ext.create("SpiceCRM.KReporter.Bucketmanager.store.modules",{storeId:"KReportBucketmanagerModuleStore"}),allowBlank:!1,displayField:"name",valueField:"module",text:"modules",forceSelection:!0,width:"80%",margin:5,listeners:{select:function(a){var b=Ext.data.StoreManager.lookup("KReportBucketmanagerFormFieldEnumStore");b.removeAll(),b.getProxy().extraParams.modulename=a.value,b.load()}}},{xtype:"combo",name:"fieldname",itemId:"mainFieldSelector",fieldLabel:languageGetText("LBL_GROUPING_ENUMFIELDS"),queryMode:"local",typeAhead:!0,minChars:2,width:"80%",store:Ext.create("SpiceCRM.KReporter.Bucketmanager.store.enumfields",{storeId:"KReportBucketmanagerFormFieldEnumStore"}),allowBlank:!1,displayField:"text",valueField:"name",text:"fields",forceSelection:!0,margin:5,listeners:{select:function(a){}}}]}),Ext.define("SpiceCRM.KReporter.Bucketmanager.Application",{namespaces:["SpiceCRM.KReporter.Bucketmanager"],controllers:["Application"],extend:"Ext.app.Application",name:"SpiceCRM.KReporter.Bucketmanager",thisMainView:!1,launch:function(){SpiceCRM.KReporter.Bucketmanager.Application=this,SpiceCRM.KReporter.Bucketmanager.Application._enumValuesToHide=[],SpiceCRM.KReporter.Bucketmanager.Application._enumValuesStoreOriginal=Ext.create("SpiceCRM.KReporter.Bucketmanager.store.listEnumValues",{storeId:"KReportBucketmanagerListEnumValuesOriginalStore"}),SpiceCRM.KReporter.Bucketmanager.Application._enumValuesPageSize=20,this.render()},destroyMainView:function(){this.thisMainView.destroy(),this.thisMainView=!1,this.groupingRecord=Ext.create("SpiceCRM.KReporter.Bucketmanager.model.listGroupings")},render:function(){this.thisMainView=Ext.create("SpiceCRM.KReporter.Bucketmanager.view.main.Main"),Ext.get(window).on({resize:function(){SpiceCRM.KReporter.Bucketmanager.Application.thisMainView&&SpiceCRM.KReporter.Bucketmanager.Application.thisMainView.updateLayout()}})},languageGetText:function(a){return SUGAR.language.get("KReports",a)},getRand:function(){return Math.random()},S4:function(){return(65536*(1+this.getRand())|0).toString(16).substring(1)},kGuid:function(){return"k"+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()}}),Ext.application({extend:"SpiceCRM.KReporter.Bucketmanager.Application"}),Ext.onReady(function(){});